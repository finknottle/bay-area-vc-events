<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bay Area VC Events</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background: #f9fafb; color: #111827; }
      .container { max-width: 800px; margin: 0 auto; padding: 2rem 1rem; }
      h1 { font-size: 1.875rem; font-weight: 700; margin-bottom: 0.5rem; }
      .muted { color: #6b7280; font-size: 0.875rem; }
      .search-box { margin: 1.5rem 0; }
      input { padding: 0.75rem 1rem; width: 100%; border: 1px solid #d1d5db; border-radius: 0.5rem; box-sizing: border-box; font-size: 1rem; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
      .event-card { background: white; padding: 1.25rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
      .event-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
      .event-source { font-weight: 600; color: #4f46e5; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.025em; }
      .event-title { font-size: 1.125rem; font-weight: 700; line-height: 1.4; margin: 0.25rem 0; }
      .event-title a { color: #111827; text-decoration: none; border-bottom: 2px solid transparent; }
      .event-title a:hover { border-bottom-color: #4f46e5; }
      .meta-row { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 0.75rem; font-size: 0.875rem; color: #4b5563; }
      .meta-item { display: flex; align-items: center; gap: 0.25rem; }
      .badge { padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; background: #f3f4f6; color: #374151; }
      .badge-price { background: #dcfce7; color: #166534; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Bay Area VC Events</h1>
      <p class="muted">Live monitoring of venture and tech community events.</p>

      <div class="search-box">
        <input id="q" placeholder="Search by city, host, or keyword (AI, SF, Demo Day)..." />
      </div>

      <div id="list"></div>
    </div>

    <script>
      async function load() {
        const res = await fetch(`./events.json?t=${Date.now()}`, { cache: 'no-store' });
        const data = await res.json();
        return data.events || [];
      }

      function render(events, q) {
        const list = document.getElementById('list');
        list.innerHTML = '';
        const query = (q || '').toLowerCase().trim();
        
        let filtered = events.filter(e => {
          if (!query) return true;
          const searchStr = `${e.title} ${e.source_name} ${e.location} ${e.source_url}`.toLowerCase();
          return searchStr.includes(query);
        });

        filtered.sort((a, b) => {
          const da = a.start ? new Date(a.start) : new Date('2099-01-01');
          const db = b.start ? new Date(b.start) : new Date('2099-01-01');
          return da - db;
        });

        if (!filtered.length) {
          list.innerHTML = '<div class="muted">No upcoming events found matching your search.</div>';
          return;
        }

        for (const e of filtered) {
          const card = document.createElement('div');
          card.className = 'event-card';

          const start = e.start ? new Date(e.start) : null;
          const dateStr = start ? start.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }) : 'Date TBA';
          const timeStr = start ? start.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' }) : '';

          let city = 'Bay Area';
          if (e.location) {
            const l = e.location.toLowerCase();
            if (l.includes('san francisco') || l.includes(' sf')) city = 'San Francisco';
            else if (l.includes('palo alto')) city = 'Palo Alto';
            else if (l.includes('mountain view')) city = 'Mountain View';
            else if (l.includes('menlo park')) city = 'Menlo Park';
            else if (l.includes('san jose')) city = 'San Jose';
          }

          const rsvpUrl = e.rsvp_url || e.source_url;

          card.innerHTML = `
            <div class="event-header">
              <span class="event-source">${e.source_name}</span>
              <span class="badge badge-price">${e.price || 'Free / TBA'}</span>
            </div>
            <div class="event-title"><a href="${rsvpUrl}" target="_blank">${e.title}</a></div>
            <div class="meta-row">
              <div class="meta-item">üìÖ ${dateStr} ${timeStr}</div>
              <div class="meta-item">üìç ${city}</div>
              <div class="meta-item muted">${e.location || ''}</div>
            </div>
          `;
          list.appendChild(card);
        }
      }

      (async function() {
        const events = await load();
        const q = document.getElementById('q');
        render(events, '');
        q.addEventListener('input', () => render(events, q.value));
      })();
    </script>
  </body>
</html>

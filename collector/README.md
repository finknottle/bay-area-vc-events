# Collector

## Gmail authorization (personal Gmail, headless VPS via Docker)

This project uses **OAuth** with the **Gmail read-only** scope.

### Files you will end up with
Create a folder named `secrets/` **next to your docker-compose.yml on the VPS host** (NOT committed to git):

- `secrets/gmail_oauth_client.json` (downloaded from Google Cloud)
- `secrets/gmail_token.json` (generated by the auth script)

### Step 1 — Create OAuth credentials (Google Cloud Console)
1. Open: https://console.cloud.google.com/
2. Create a project (example: `bay-area-vc-events-gmail`)
3. **APIs & Services → Library** → enable **Gmail API**
4. **OAuth consent screen**
   - User type: **External**
   - Add your Gmail as a **Test user**
5. **Credentials → Create credentials → OAuth client ID**
   - Application type: **Desktop app**
6. Download the client JSON and rename it to: `gmail_oauth_client.json`

### Step 2 — Run the one-time auth flow on your laptop
Do this on a machine where you can open a browser (laptop).

```bash
git clone https://github.com/finknottle/bay-area-vc-events.git
cd bay-area-vc-events/collector
npm install

mkdir -p ./secrets
# Put the downloaded google client JSON here:
#   ./secrets/gmail_oauth_client.json

npm run gmail:auth -- \
  --client ./secrets/gmail_oauth_client.json \
  --out    ./secrets/gmail_token.json
```

The script will print a URL. Open it, approve access, and it will save `./secrets/gmail_token.json`.

### Step 3 — Copy secrets to the VPS host
Copy the entire `secrets/` folder to your VPS host (outside the container image), for example:

- `/opt/bay-area-vc-events/secrets/gmail_oauth_client.json`
- `/opt/bay-area-vc-events/secrets/gmail_token.json`

### Step 4 — Mount secrets into Docker
Example `docker-compose.yml` snippet:

```yaml
services:
  collector:
    image: your-image
    volumes:
      - /opt/bay-area-vc-events/secrets/gmail_oauth_client.json:/run/secrets/gmail_oauth_client.json:ro
      - /opt/bay-area-vc-events/secrets/gmail_token.json:/run/secrets/gmail_token.json:ro
    environment:
      - GMAIL_OAUTH_CLIENT=/run/secrets/gmail_oauth_client.json
      - GMAIL_TOKEN=/run/secrets/gmail_token.json
```

### Troubleshooting
- If `gmail_token.json` has **no** `refresh_token`, revoke access at https://myaccount.google.com/permissions and re-run the script.
